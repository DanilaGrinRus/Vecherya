# K2 — GitHub Pages (UI) + Cloudflare Worker (JSON)

Важное правило:
- **GitHub Pages** хостит только **UI** (статические файлы).
- **Cloudflare Worker** выполняет **парсинг Telegram**, применяет правила и отдаёт **готовый JSON**.
- UI на Pages только запрашивает JSON и отображает (без парсинга и бизнес-логики).

## Содержимое репозитория

- `index.html` — ваш UI (файл оставлен без изменений).
- `docs/worker_site_contract_v1.md` — контракт Worker → Site: формат JSON, поля, правила приоритета (в частности: если карта попала в `active`, она не должна присутствовать в количественных `counts`).

## Как разместить на GitHub Pages

1) Создайте репозиторий на GitHub (публичный или приватный — по вашему плану).

2) Загрузите содержимое этого пакета в репозиторий:
- если вы кладёте файлы в корень репозитория — `index.html` должен лежать в корне;
- `docs/` можно оставить как есть.

3) Включите Pages:
- откройте репозиторий → Settings → Pages;
- Source: Deploy from a branch;
- Branch: `main` (или `master`, если так у вас называется);
- Folder: `/(root)`;
- Save.

4) GitHub покажет публичный URL вида:
`https://<username>.github.io/<repo>/`

5) Откройте этот URL и проверьте, что страница загрузилась.

## Что нужно изменить только для подключения Worker

В вашем `index.html` уже задан адрес воркера константой:
`TG_WORKER_URL = "..."`

Для работы с вашим Worker нужно заменить это значение на ваш реальный публичный endpoint.

Важно:
- это изменение не затрагивает визуал;
- это просто настройка “куда UI делает запрос”.

## Обязательные требования к Worker (чтобы Pages смог читать ответ)

1) CORS.
Worker должен возвращать заголовок `Access-Control-Allow-Origin` так, чтобы запрос с домена GitHub Pages не блокировался браузером.

2) Content-Type.
Worker должен отвечать JSON с корректным `Content-Type: application/json`.

3) Контракт.
Формат JSON должен соответствовать `docs/worker_site_contract_v1.md`. UI не должен исправлять данные.

## Проверка, что всё работает

1) Откройте сайт на GitHub Pages.
2) Откройте DevTools → Network.
3) Найдите запрос к URL Worker.
4) Убедитесь, что:
- статус 200;
- приходит JSON;
- структура совпадает с контрактом.

## Типовые проблемы

- Ошибка CORS в консоли.
  Причина: Worker не выставляет нужные заголовки.

- Ответ 404/500.
  Причина: неверный URL Worker или ошибка внутри воркера.

- UI “пустой”, но запрос 200.
  Причина: Worker вернул JSON не по контракту или пустые данные.

